# =============================================================================
# DOMAIN CONFIGURATION
# To use this template for a new site, update the domain below:
# =============================================================================
# DOMAIN: psph.org
# =============================================================================

# --- Canonical: HTTPS + non-www (template-safe for multiple domains) ---
RewriteEngine On
Options -MultiViews

# If this site is copied to other domains, DO NOT hardcode a single domain here.
# 1) Strip leading www. for any domain
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

# 2) Force HTTPS on the current host
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# --- Search indexing ---
# NOTE: We intentionally allow indexing to improve reputation / categorization in school/enterprise content filters.
# If you need to prevent indexing later, do it selectively (e.g., only on the scheduling page), not site-wide.

# --- Remove trailing slashes (except root) ---
RewriteCond %{REQUEST_URI} !^/$
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+?)/$ /$1 [R=301,L]

# --- Redirect .html extension to clean URLs ---
RewriteCond %{THE_REQUEST} \s/+(.+?)\.html[\s?] [NC]
RewriteRule ^ /%1 [R=301,L]

# --- Short-circuit actual files/dirs (keeps PHP endpoints reachable) ---
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# --- Serve extensionless URLs as .html ---
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.+?)$ $1.html [L]

# --- Security headers ---
# For maximum compatibility with school/managed browsers and web filters,
# we intentionally avoid strict security headers (especially Content-Security-Policy) here.
# The older microsite that was blocked less often shipped with no CSP.
